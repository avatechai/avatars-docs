---
title: "Next JS Demo"
---

For a complete demo and GitHub repo, you can check this out directly. 
- [Live Demo](https://avatars-nextjs-demo.vercel.app/)
- [Interactive Demo](https://avatars-nextjs-demo.vercel.app/demo)

<Card
    title="Next JS"
    href="https://github.com/avatechgg/avatars-nextjs-demo"
    icon={
      <svg width="35" height="35" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_1102_12384)"><mask id="mask0_1102_12384" mask-type="alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="35" height="35"><path d="M17.5 35C27.165 35 35 27.165 35 17.5C35 7.83502 27.165 0 17.5 0C7.83502 0 0 7.83502 0 17.5C0 27.165 7.83502 35 17.5 35Z" fill="black"></path></mask><g mask="url(#mask0_1102_12384)"><path d="M34.25 17.5C34.25 26.7508 26.7508 34.25 17.5 34.25C8.24923 34.25 0.75 26.7508 0.75 17.5C0.75 8.24923 8.24923 0.75 17.5 0.75C26.7508 0.75 34.25 8.24923 34.25 17.5Z" fill="black" stroke="white" stroke-width="1.5"></path><path d="M29.071 30.6289L13.4443 10.5H10.5V24.4942H12.8554V13.4913L27.222 32.0532C27.8703 31.6194 28.4879 31.1432 29.071 30.6289Z" fill="url(#paint0_linear_1102_12384)"></path><path d="M24.6947 10.5H22.3613V24.5H24.6947V10.5Z" fill="url(#paint1_linear_1102_12384)"></path></g></g><defs><linearGradient id="paint0_linear_1102_12384" x1="21.1944" y1="22.6528" x2="28.0972" y2="31.2083" gradientUnits="userSpaceOnUse"><stop stop-color="white"></stop><stop offset="1" stop-color="white" stop-opacity="0"></stop></linearGradient><linearGradient id="paint1_linear_1102_12384" x1="23.528" y1="10.5" x2="23.4889" y2="20.7813" gradientUnits="userSpaceOnUse"><stop stop-color="white"></stop><stop offset="1" stop-color="white" stop-opacity="0"></stop></linearGradient><clipPath id="clip0_1102_12384"><rect width="35" height="35" fill="white"></rect></clipPath></defs></svg>
    }
  >
    With Next JS, Vercel AI, a simple chat with avatar experience.
</Card>

### Setup

Create a new Next.js app.

```bash
pnpm dlx create-next-app my-ai-app
cd my-ai-app
pnpm install ai openai-edge
```

Setup the OpenAI API key in your environment variables.

```
OPENAI_API_KEY=xxxxxxxxx
```

```jsx app/api/chat/route.ts
import { Configuration, OpenAIApi } from 'openai-edge'
import { OpenAIStream, StreamingTextResponse } from 'ai'
 
// Optional, but recommended: run on the edge runtime.
// See https://vercel.com/docs/concepts/functions/edge-functions
export const runtime = 'edge'
 
const apiConfig = new Configuration({
  apiKey: process.env.OPENAI_API_KEY!
})
 
const openai = new OpenAIApi(apiConfig)
 
export async function POST(req: Request) {
  // Extract the `messages` from the body of the request
  const { messages } = await req.json()
 
  // Request the OpenAI API for the response based on the prompt
  const response = await openai.createChatCompletion({
    model: 'gpt-3.5-turbo',
    stream: true,
    messages: messages
  })
 
  // Convert the response into a friendly text-stream
  const stream = OpenAIStream(response)
 
  // Respond with the stream
  return new StreamingTextResponse(stream)
}
```

Integrate the avatrar display in your react tree.

```jsx chat.tsx
export default function Chat() {
  const {
    messages,
    input,
    handleInputChange,
    handleSubmit,
    isLoading,
    setMessages,
  } = useChat()
  
  const [text, currentEmotion] = getAIReplyWithEmotion(messages, isLoading)

  const {
    avatarDisplay,
    handleFirstInteractionAudio,
    availableEmotions,
    context,
  } = useAvatar({
    // Avatar State
    text: text,
    currentEmotion: currentEmotion,
    avatarId: 'af3f42c9-d1d7-4e14-bd81-bf2e05fd11a3',

    // Loader + Plugins
    avatarLoaders: defaultAvatarLoaders,
    blendshapesService: defaultBlendshapesService_2,

    audioService: elevenLabs,

    // Style Props
    scale: 4,
    className: 'w-[400px] h-[400px]',
  })

  // Set initial prompt
  useEffect(() => {
    if (!availableEmotions) return

    setMessages([
      {
        content: buildCharacterPersonaPrompt({
          name: 'Ava',
          context: 'Im ava, a virtual idol from avatechs.',
          exampleReplies: ['I am ava!', 'I love next js!', 'What are you working on recently?', 'npm i @avatechai/avatars'],
          emotionList: availableEmotions,
        }),
        role: 'system',
        id: '1',
      },
    ])
  }, [availableEmotions])

  return <>
   {/* The rest of the UI */}
  </>
}
```

Using the avatar hook you created!

```jsx chat.tsx
export default function Chat() {

  // The reset of the hook

  return (
    <>
      <div className="md:max-w-md py-24 flex flex-col stretch ">
        {/* Avatar Display */}
        {avatarDisplay}

        {/* Message Display */}
        {messages.map(
          (m) =>
            m.role != 'system' && (
              <div key={m.id}>
                {m.role === 'user' ? 'User: ' : 'AI: '}
                {m.content}
              </div>
            ),
        )}
      </div>

      {/* Input */}
      <form
        onSubmit={(e) => {
          e.preventDefault();
          handleSubmit(e);
          handleFirstInteractionAudio();
        }}
        className="max-w-md fixed bottom-0 flex items-center gap-2 justify-center mb-8 w-full"
      >
        <input
          placeholder="Say something..."
          className="max-w-md border border-gray-300 rounded shadow-xl p-2 w-full"
          value={input}
          onChange={handleInputChange}
        />

        <button type="submit">Send</button>
      </form>
    </>
  );
}
```